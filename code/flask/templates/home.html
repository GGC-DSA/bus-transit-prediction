<head>

 <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
   integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
   crossorigin=""/>

 <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
   integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
   crossorigin=""></script>





<link rel = "stylesheet" type="text/css" href = "{{url_for('static',filename='style.css')}}">

<!-- dropdown utils-->
<script src="{{url_for('static',filename='drop.js')}}"></script>

<link rel = "stylesheet" type="text/css" href = "{{url_for('static',filename='dropDown.css')}}">


<!-- BusMap heigh styling --> 
 <style>
 #busMap{
 height:700px;
 }
 </style>

</head>

<!-- main webpage section -->

<body>

<div class="header">
  <h1>MARTA Bus Transit Prediction Project</h1>
  <p>Made by Team BusNet</p>
</div>

<div class="topnav">
  <a href="/Code">Code</a>
  <a href="/AboutUs">About Us</a>
  <a href="/Data">Data</a>
 <!-- <a href="#" style="float:right">Link</a>  -->
</div>

<!--   Map Place HERE -->
<div class="row">
  <div class="leftcolumn">
    <div class="card">
      <h2>Map</h2>

      Data last updated At: <b>{{update_time}}</b>
      <br>There are currently <b>{{home_annoc[0]}}</b> buses running across <b>{{home_annoc[1]}}</b> routes
      <br>
       
      
            
      <div id="busMap"></div>
      
      
      
      
      
      <script>
           
           //var encode_key = {{encode_key|safe}}
           
            //south,north,east,west
          /* #TODO  fix issues with custom icon defining and utilize custom directional icons.
           south = L.icon({
           iconUrl:"{{url_for('static',filename='images/marta_logo_n_res.png')}}",
           shadowUrl:"{{url_for('static',filename='images/marta_logo_gen_res.png')}}",
           iconSize:[146,27],
           shadowSize:[146,27],
           iconAnchor:[60,15],
           shadowAnchor:[60,15],
           popupAnchor:[0,10]
           })
           */
      
           //sets location (lon lat zoom) for initial map position
           const myMap = L.map('busMap').setView([33.7490,-84.3880],11);
           
           var value = {{value|safe}}
           var stops = {{stops|safe}}
           
           //console.log(value.get(0));
           
           //required attribution for tiler
           const attribution = 
                 '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors';
           
           //tile utility api link
           const tile_url = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
           
           //collect tiles
           const tiles = L.tileLayer(tile_url,{attribution})
           
           //build map
           tiles.addTo(myMap);
           
           //add markers
           
           var busIcon = L.icon({
           iconUrl: "{{url_for('static',filename='images/bus.png')}}",
           iconSize: [48,48],
           iconAnchor: [24,48],
           popupAnchor:[0,-28]});
           
           
           var stopIcon = L.icon({
           iconUrl: "{{url_for('static',filename='images/bus-stop.png')}}",
           iconSize: [32,32],
           iconAnchor: [16,32],
           popupAnchor:[0,-16]});
           
           //layer declaration
           
           var mainLayer = L.layerGroup();
           
           var dynamicLayer = L.layerGroup();
           
           
           //method declarations
           
           
           var stopBuild = function(routeID){
           
           //builds stop markers
                 for(var i=0;i<stops.length;i++){
                 
                       if(stops[i][3]==routeID){
                       
                            marker = L.marker([stops[i][1],stops[i][0]],{icon:stopIcon});
                            marker.bindPopup("<b>Stop <br> ID:</b> "+stops[i][2]+"<br> <b>Route:</b> "+stops[i][3]);
                            dynamicLayer.addLayer(marker); 

                       }
                 
                 
                 }
           }
           
           
           
           
           
           
           var mainMapBuilder = function(){
                 for(var i=0;i<value.length;i++){
                       //console.log(value.get(i));
                       //{Icon:south}
                       marker = L.marker([value[i][1],value[i][0]],{icon:busIcon});
                       marker.bindPopup("<b>Vehicle <br> ID:</b> "+value[i][2]+"<br> <b>Route:</b> "+value[i][4]
                             +"<br> <b> Direction:</b> "+value[i][3] );
                       mainLayer.addLayer(marker);
           }
           }
           
           
           var mapClear = function(layer){
                 layer.clearLayers();
           }
           
           
           
           
           
           
           var buildRoute = function(routeID){
           
               //builds bus markers
                 for(var i=0;i<value.length;i++){
                 
                       if(value[i][4]==routeID){
                             
                             marker = L.marker([value[i][1],value[i][0]],{icon:busIcon});
                             marker.bindPopup("<b>Vehicle <br> ID:</b> "+value[i][2]+"<br> <b>Route:</b> "+value[i][4]
                                   +"<br> <b> Direction:</b> "+value[i][3] );
                             dynamicLayer.addLayer(marker);
                 
                 
                       }
                 }
                 stopBuild(routeID);
                 
           }
           
           
           
           
           
           
           //start main map view
           //mainMapBuilder()
          // mainLayer.addTo(myMap)
          
          buildRoute(4);
          dynamicLayer.addTo(myMap)
           
           
           
           
      </script>
      
      <!--<script src="{{url_for('static',filename='mapper.js')}}"></script>-->
      <p>Some text..</p>
      
      <p>Sunt in culpa qui officia deserunt mollit anim id est laborum consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco.</p>
    </div>

</div>
  
<!-- End buttons / start side bars -->
  <div class="rightcolumn">
    <div class="card">
      <h2>Route Selection</h2>
      <div class="fakeimg" style="height:100px;">
      <div class="dropdown">
  <button onclick="myFunction()" class="dropbtn">Select a Route</button>
  <div id="myDropdown" class="dropdown-content">
    <input type="text" placeholder="Search.." id="myInput" onkeyup="filterFunction()">
          <a href="#about">About</a>
          <a href="#base">Base</a>
          <a href="#blog">Blog</a>
          <a href="#contact">Contact</a>
          <a href="#custom">Custom</a>
          <a href="#support">Support</a>
          <a href="#tools">Tools</a>
        </div>
      </div>
      
      </div>
      <p>list of buttons here for selecting routes</p>
    </div>
    <div class="card">
      <h3>Vehicle Selection</h3>
      <p> list of buttons here for selecting by vehicle (maybe) </p>
    </div>
    <div class="card">
      <h3>Submit button? or time slider</h3>
      <p>Some text..</p>
    </div>
  </div>
</div>

<div class="footer">
  <h2>SST, GGC Logos?</h2>
  <div>Icons made by <a href="https://www.freepik.com" title="Freepik">Freepik</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
  <!--<div class="fakeimg">-->
     <!--   <image src="{{url_for('static',filename='images/ggc_ad.png')}}"> -->
 <!-- </div>-->
</div>

</body>

